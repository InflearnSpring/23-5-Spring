## MVC 프레임워크 구현
---
## 기존 MVC 패턴의 한계
- **request, response 활용도 낮음** : jsp파일로 forward 하므로
- **중복 작업**의 존재 : 선언부의 Servlet 관련 코드, view 호출 로직

#### --> Spring MVC와 유사한 구조로, 점진적으로 개선
---
### v1 - Front Controller 패턴 적용
로직은 유지하고, 구조만 변경

![image](https://github.com/EhighG/23-5-Spring/assets/71206505/5b7d0232-cfdb-470f-ad1b-b83ad6c5c3fb)

```java
public class FrontControllerServletV1 extends HttpServlet {

    // 매핑 정보
    private Map<String, ControllerV1> controllerMap = new HashMap<>(); // 다형성의 활용 1

    public FrontControllerServletV1() {
        String basePath = "/front-controller/v1/members";

        controllerMap.put(basePath + "/new-form", new MemberFormControllerV1());
        controllerMap.put(basePath + "/save", new MemberSaveControllerV1());
        controllerMap.put(basePath, new MemberListControllerV1());
    }
  
    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        ..
        ControllerV1 controller = controllerMap.get(requestURI); // 다형성의 활용 2
        controller.process(request, response);
    }
    ...
}
```

- 요청이 오면, FrontController가 **각 Controller로 전달**
- 실행 순서 : FrontController -> Controller -> jsp파일

#### <장점>
- **공통 로직 처리 가능** : 모든 요청이 FrontController를 거치므로, 거기서 처리
- ```@WebServlet()``` **중복 제거** : FrontController로 뺐다.
#### <한계점>
- **서블릿 종속성** : Controller들이 request, response에 여전히 의존
- **코드 중복** : 구조만 변경했으므로, 중복이 여전히 많음.
---
### v2 - View 분리
view 관련 중복 코드(viewPath 선언 ~ forward) 분리

![image](https://github.com/EhighG/23-5-Spring/assets/71206505/92002d4d-13a5-48a1-bc13-83552eaafbea)

- view 관련 로직을 MyView 클래스로 분리
- Controller들은 request(Model)에 데이터 저장까지 마친 후, viewPath가 담긴 MyView 반환
- FrontController가 MyView.render() 호출
- 실행 순서 : FrontController -> Controller -> FrontController -> MyView -> jsp파일

#### <장점>
- **관심사의 분리** : Controller들의 역할에서 view 관련 부분이 제거됨
- **중복 제거** : view 관련 코드 중복 제거

#### <한계점>
- **서블릿 의존성** : 여전히 request, response를 받고, request를 Model로 사용
- **코드 중복** : MyView 생성&반환과 viewPath -> 더 줄일 수 있다.

---

### v3 - Model 추가
request -> paramMap, ModelView 로 대체하여, **Controller들의 서블릿 종속성 완전 제거**

![image](https://github.com/EhighG/23-5-Spring/assets/71206505/31d17b49-28ae-414a-a1e1-92c6bb3f29be)

- ModelView는 viewName과 model을 포함
- viewPath 생성 로직의 분리 -> ```FrontController.viewResolver(String viewName)```
> **viewResolver** : viewName(논리 이름) -> viewPath(물리적 이름)
- MyView 변경 : model -> request로 데이터 옮기는 작업 추가

#### <장점>
- **서블릿 의존성 제거** : Controller.process() 선언부의 단순화
- **viewPath 설정 간소화** : prefix, suffix 제거

#### <한계점>
- **ModelView 코드 반복** : Controller들에서 매번 생성해서 반환해야.
> **ModelView 관련 의문점** - 
> viewPath와 model을 따로 두는 게 더 좋지 않을까?

---

### v4 - 단순하고 실용적인 컨트롤러
**Controller 편의성 향상** : 데이터는 매개변수 model에 넣고, viewName만 반환하는 방식

![image](https://github.com/EhighG/23-5-Spring/assets/71206505/8298ec0a-6fc1-4a45-8db0-cfc413c235a4)

#### <장점>
- Model, View 관련 코드 단순화 : model.put(data), return viewName 등, 가장 단순하고 깔끔해짐
> - Model과 ViewName의 분리? 개인적인 생각

#### <한계점>
- **유연성** : 같은 버전의 Controller(같은 인터페이스를 구현한 Controller)만 사용 가능

---

### v5 - 유연한 컨트롤러 & 어댑터 패턴
**여러 버전의 컨트롤러를 같이 사용하고 싶다면?**

![image](https://github.com/EhighG/23-5-Spring/assets/71206505/12a8d962-0d09-4e54-9ea7-a514850f0de2)

- **HandlerAdapter** 추가
  - 기능 : controller 호출, 반환값 형식 통일
    - FrontController 입장에서 **항상 HandlerAdapter(인터페이스)를 호출**하고, **일관된 형식의 반환값** 받도록
- **Handler** : Controller를 포함하는, 상위 개념

#### HandlerAdapter
아래는 v4 HandlerAdapter 코드 일부

```java
public class ControllerV4HandlerAdapter implements MyHandlerAdapter {
    @Override
    public boolean supports(Object handler) {
        return (handler instanceof ControllerV4);
    }

    @Override
    public ModelView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws ServletException, IOException {
        ControllerV4 controller = (ControllerV4) handler;

        Map<String, String> paramMap = createParamMap(request);
        Map<String, Object> model = new HashMap<>();

        String viewName = controller.process(paramMap, model);

        ModelView mv = new ModelView(viewName);
        mv.setModel(model);

        return mv;
    }
}
```
- supports() : 해당 handler에 대한 지원 여부 반환
  - FrontController.getHandlerAdapter() 에서, 적절한 어댑터를 찾을 때 사용
- handle() : 실제 controller 호출 + 반환값 통일하는 부분

#### <장점>
- **OCP 준수** : HandlerMap과 HandlerAdapters만 외부 주입으로 돌리면, FrontController를 수정하지 않은 채 확장이 가능하다.
<br>

### 실행 코드
- [Github](https://github.com/EhighG/Spring_MVC_1)
