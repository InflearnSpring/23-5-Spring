## 웹 애플리케이션 이해

### 모든 것이 HTTP

HTTP 메시지에 모든 것을 전송

- HTML, TEXT
- IMAGE, 음성, 영상, 파일
- JSON, XML(API)
- 거의 모든 형태의 데이터 전송 가능
- 서버간에 데이터를 주고 받을 때도 대부분 HTTP 사용
- 지금은 HTTP 시대!

### 웹 서버(Web Server)

- HTTP 기반으로 동작
- 정적 리소스 제공, 기타 부가기능
- 정적 HTML, CSS, JS 이미지, 영상
- 예) NGINX, APACHE

### 웹 애플리케이션 서버(WAS - Web Application Server)

- HTTP 기반으로 동작
- 웹 서버 기능 포함 + (정적 리소스 제공 가능)
- 프로그램 코드를 실행해서 애플리케이션 로직 수행
  - 동적 HTML, HTTP API(JSON)
  - 서블릿, JSP, 스프링 MVC
- 예) 톰캣(Tomcat), Jetty, Undertow

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/701eaaa2-1aa4-4220-a08b-55f6a2eb5c9e/Untitled.png)

### 웹 서버, 웹 애플리케이션 서버(WAS) 차이

- 웹 서버는 정적 리소스(파일), WAS는 애플리케이션 로직
- 사실은 둘의 용어도 경계도 모호함
  - 웹 서버도 프로그램을 실행하는 기능을 포함하기도 함
  - 웹 애플리케이션 서버도 웹 서버의 기능을 제공함
- 자바는 서블릿 컨테이너 기능을 제공하면 WAS
  - 서블릿 없이 자바코드를 실행하는 서버 프레임워크도 있음
- WAS는 애플리케이션 코드를 실행하는데 더 특화

### 웹 시스템 구성 - WAS, DB

- WAS, DB 만으로 시스템 구성 가능
- WAS는 정적 리소스, 애플리케이션 로직 모두 제공 가능

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0f564bc7-0cc0-4047-b05d-3334cc060f76/Untitled.png)

- WAS가 너무 많은 역할을 담당, 서버 과부하 우려
- 가장 비싼 애플리케이션 로직이 정적 리소스 때문에 수행이 어려울 수 있음
- WAS 장애시 오류 화면도 노출 불가능

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/41e57f99-b6a7-453e-a149-faf584ac413f/Untitled.png)

### 웹 시스템 구성 - WEB, WAS, DB

- 정적 리소스는 웹 서버가 처리
- 웹 서버는 애플리케이션 로직같은 동적인 처리가 필요하면 WAS에 요청을 위임
- **WAS는 중요한 애플리케이션 로직 처리 전담**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d594bdaa-98e5-4e67-87e3-1749a6679b90/Untitled.png)

- 효율적인 리소스 관리
  - 정적 리소스가 많이 사용되면 Web 서버 증설
  - 애플리케이션 리소스가 많이 사용되면 WAS 증설

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6bd6be54-97f3-4ff3-a792-c71052aca3ff/Untitled.png)

- 정적 리소스만 제공하는 웹 서버는 잘 죽지 않음
  - 웹 서버는 계산하거나 복잡한 logic이 없다
- 애플리케이션 로직이 동작하는 WAS 서버는 잘 죽음
- WAS, DB 장애시 WEB 서버가 오류 화면 제공 가능

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2f2adc02-d93f-4d2e-9208-86de4e28f377/Untitled.png)

## 서블릿

### HTML Form 데이터 전송

POST 전송 - 저장

form태그로 데이터를 전송하면 웹 브라우저가 요청 HTTP 메시지를 생성하여 클라이언트에서 서버로 전달한다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/de793f7f-edc7-41c0-913c-7fcd4da234b2/Untitled.png)

### 서버에서 처리해야 하는 업무

- 의미있는 비즈니스 로직은 적은데 다른 해야 할 것이 너무 많다
  - ⇒ 서블릿을 지원하는 WAS 사용하면 서블릿이 이를 자동으로 해결해준다.

### 서블릿

- 개발자는 HTTP 스펙을 매우 편리하게 사용할 수 있다
- WAS가 req, res 객체를 새로 만들어서 서블릿을 호출한다

### 서블릿 컨테이너

- 서블릿 객체는 **싱글톤**으로 관리(공유)
  - req, res는 항상 새로운 객체를 만들지만 서블릿 컨테이너의 helloServlet은 싱글톤으로 딱 하나를 관리한다.

## 동시요청 - 멀티 쓰레드

### 쓰레드

- 애플리케이션 코드를 순차적으로 실행하는 것
  - 실행시켜주는 애
  - 하나에 하나만 처리
- 동시 처리가 필요하면 쓰레드 하나가 추가로 필요

### 다중 요청 - 쓰레드 하나 사용 시

- 응답이 느려진다
  - 처리 지연
- Timeout error

### 요청 마다 쓰레드 생성

- 호출 마다 쓰레드 생성하면 처리 지연 X
- 장점
  - 동시 요청 처리 O
- 단점
  - 쓰레드는 비용이 매우 비싸다
  - 쓰레드는 컨텍스트 스위칭 비용이 발생한다
    - A 쓰레드 다음 B 쓰레드로 작업을 진행할 때 드는 비용
    - 작업이 빨라서 동시에 하는 것처럼 보인다(사실 차례로 하는 것)
  - 쓰레드 생성에 제한이 없다

### 쓰레드 풀

- 쓰레드 풀 안에서 놀고 있는 쓰레드에게 각 요청을 연결한다
- 사용이 끝나면 쓰레드 풀에 다시 반납한다
- 쓰레드 풀이 모두 사용중일 때 쓰레드 대기나 거절을 할 수 있다
  - 생성 가능한 최대치를 관리한다
- 장점
  - 쓰레드 생성, 종료 비용이 절약되고, 응답 시간이 빠르다
  - 생성 최대치가 있으므로 너무 많은 요청이 와도 기존 요청은 안전히 처리할 수 있다
- 실무 팁
  - WAS의 주요 튜닝 포인트는 **최대 쓰레드 수**이다
- 쓰레드 풀의 적정 숫자
  - 상황에 따라 다르다
- 개발자가 멀티 쓰레드 관련 코드는 신경쓰지 않아도 된다
  - 싱글톤 객체는 주의하여 사용

## HTML, HTTP API, CSR, SSR

### HTTP API

- HTML이 아니라 데이터를 전달
- 주로 JSON 형식 사용
- 데이터만 주고 받는다

### SSR - 서버 사이드 렌더링

서버에서 최종 HTML을 생성해서 클라이언트에 전달

### CSR - 클라이언트 사이드 렌더링

- HTML 결과를 동적으로 생성해 적용한다
- 예) 구글지도

### 어디까지 알아야 하나요?

백엔드 개발자 입장에서 UI 기술

- 선택과 집중
  - 백엔드 개발자의 웹 프론트 기술 학습은 옵션
  - 백엔드 개발자는 서버, DB, 인프라 등등 수 많은 백엔드 기술을 공부해야 한다
  - 웹 프론트엔드도 깊이있게 잘 하려면 숙련에 오랜 시간이 필요하다

## 자바 백엔드 웹 기술 역사

과거 기술

- 서블릿
  - HTML 작성 어렵다
- JSP - 1999
  - HTML 편리하지만, 비즈니스 로직까지 너무 많은 역할 담당
- 서블릿, JSP 조합 MVC 패턴 사용
  - 모델, 뷰, 컨트롤러 역할을 나눠 개발
- MVC 프레임워크의 춘추 전국시대 - 2000 초반 ~ 2010년 초반
  - MVC 패턴 자동화
  - 스프링 MVC(과거 버전)

현재 사용 기술

- 애노테이션 기반의 스프링 MVC 등장
  - @Controller
  - MVC 프레임워크의 춘추 전국시대 마무리
- 스프링 부트의 등장
  - 스프링 부트는 서버를 내장
  - 스프링 부트는 빌드 결과(Jar)에 WAS 서버 포함 → 빌드 배포 단순화

최신 기술 세분화

- Web Servlet - 스프링 MVC
- 웹 플럭스
  - 비동기 넌블러킹 처리
  - 함수형 스타일 개발
  - 서블릿 기술 사용 X
  - But 아직 실무에서 잘 사용하지 않는다

### 자바 뷰 템플릿 역사

HTML을 편리하게 생성하는 뷰 기능

- JSP
  - 속도 느림, 기능 부족
- 프리마커, 벨로시티
  - 속도 문제 해결, 다양한 기능
- 타임리프
  - 스프링 mvc와 강력한 기능 통합
  - 최선의 선택, HTML모양 유지하면서 뷰 템플릿 적용 가능
