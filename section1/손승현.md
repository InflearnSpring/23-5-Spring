## Web Server / Web Application Server

- Web Server
    - HTTP 기반으로 동작
    - **정적** 리소스 제공

- Web Application Server
    - HTTP 기반으로 동작
    - 웹 서버 기능 포함(**정적** 리소스 제공)
    - **프로그램 코드를 실행해 Application Logic을 수행**: 동적 HTML, HTTP(REST) API, 서블릿, JSP, 스프링 MVC

- 두 용어의 경계가 모호하지만, 굳이 나누자면 전자는 **'정적 리소스 제공'**, 후자는 **'Application Logic 수행'** 으로 구분함

<br>

- **일반적인 웹 시스템 구성: Web Server, WAS, DB**
- 장점
    1. **역할 분담**
    - 정적 리소스는 웹 서버가 처리
    - WAS는 중요한 애플리케이션 로직 처리 전담
    2. **효율적인 리소스 관리**
    - 정적 리소스가 많이 사용되면 Web 서버 증설
    - 애플리케이션 리소스가 많이 사용되면 WAS 증설
    3. **오류 화면 제공 가능**
    - 정적 리소스만 제공하는 웹 서버는 잘 죽지 않음
    - 애플리케이션 로직이 동작하는 WAS 서버는 잘 죽음
    - WAS, DB 장애시 WEB 서버가 오류 화면 제공 가능

---

## Servlet

- HTTP 요청이 왔을 때 **의미있는 비즈니스 로직을 제외**하고 나머지 업무들을, **서블릿을 지원하는 WAS가 처리**해준다.

<br>

### 특징

![image](https://github.com/sonshn/23-5-Spring/assets/55887179/7c8cb13f-e778-446f-9288-2287d49d32a5)

- **urlPatterns**의 URL이 호출되면 서블릿 코드가 실행
- **HttpServletRequest** - HTTP 요청 정보 편리하게 사용
- **HttpServletResponse** - HTTP 응답 정보 편리하게 제공

<br>

### HTTP 요청, 응답 흐름

![image](https://github.com/sonshn/23-5-Spring/assets/55887179/1a86fca9-93fa-4bc1-a5d8-4d39b31ec963)

- WAS는 Request, Response 객체를 새로 만들어서 서블릿 객체 호출
- 개발자는
    - **Request 객체**에서 HTTP 요청 정보를 편리하게 꺼내서 사용
    - **Response 객체**에 HTTP 응답 정보를 편리하게 입력
- WAS는 Response 객체에 담겨있는 내용으로 HTTP 응답 정보를 생성

<br>

- 서블릿 컨테이너
    - 서블릿을 지원하는 WAS를 지칭함
    - 서블릿 객체의 생명주기 관리
    - **서블릿 객체는 싱글톤으로 관리(공유 변수 사용 주의)**
    - **동시 요청을 위한 멀티 쓰레드 처리 지원**

---

## [중요!] 멀티 쓰레드

- 요청 마다 쓰레드를 생성할 때 **단점**
    1. 쓰레드는 생성 비용은 매우 비쌈: 고객의 요청이 올 때 마다 쓰레드를 생성하면, 응답 속도가 늦어짐
    2. 쓰레드는 컨텍스트 스위칭 비용이 발생
    3. 쓰레드 생성에 제한이 없음: 고객 요청이 너무 많이 오면, CPU, 메모리 임계점을 넘어서 서버가 죽을 수 있음

<br>

### **쓰레드 풀**

![image](https://github.com/sonshn/23-5-Spring/assets/55887179/d6161177-2f07-417d-a8b9-ac68b7e9cbdf)
![image](https://github.com/sonshn/23-5-Spring/assets/55887179/af11f114-bb00-4068-bf2f-4fb6380e7de1)

- 필요한 쓰레드를 쓰레드 풀에 보관하고 관리
- 쓰레드 풀에 생성 가능한 쓰레드의 최대치(변경 가능)를 관리함(톰캣은 최대 200개가 기본 설정)
- 쓰레드를 다 쓰면 쓰레드 풀에 다시 반납
- 쓰레드 풀에 0개의 쓰레드가 있으면 쓰레드 요청을 대기하거나 거절

- 장점
    1. 쓰레드가 미리 생성되어 있어, 쓰레드를 생성하고 종료하는 비용과 시간이 절약됨
    2. 생성 가능한 쓰레드의 최대치가 있으므로 너무 많은 요청이 들어와도 안전하게 처리할 수 있음

<br>

- WAS의 주요 튜닝 포인트는 **Max Thread 수**
- 따라서 **쓰레드의 풀의 적정 숫자를 찾는 것**은 백엔드 개발자에게 **매우 중요**!!! -> 답은 **성능 테스트**를 해보는 것...

<br>

### [중요!] 결론

- **멀티 쓰레드에 대한 부분은 WAS가 처리**
- **개발자가 멀티 쓰레드 관련 코드를 신경쓰지 않아도 됨**
- 개발자는 마치 **싱글 쓰레드 프로그래밍을 하듯이 편리하게 소스 코드를 개발**
- 멀티 쓰레드 환경이므로 싱글톤 객체(서블릿, 스프링 빈)는 주의해서 사용

---

## 용어 정리

### HTML
- 정적 리소스: 웹 서버에 요청하여 고정된 HTML 파일, CSS, JS, 이미지 영상 등을 제공
- HTML 페이지: WAS에 요청하여 DB에 정보를 조회한 정보를 동적으로 HTML 파일을 생성해 JSP, 타임리프를 통해 제공

### HTTP API
![image](https://github.com/sonshn/23-5-Spring/assets/55887179/df9bc8f1-2185-4380-94a6-52e49778497f)
- HTML이 아니라 데이터를 전달
- 주로 **JSON**형식 사용
- 다양한 시스템에서 호출(주로 아래 2가지 경우)
    - UI-클라이언트 접접
    - 서버-서버

> **HTTP 방식으로 데이터를 주고받을 때** 백엔드 개발자가 고민해야 하는 것
>> 1. 정적 리소스 제공 방법
>> 2. 동적으로 제공되는 HTML 페이지 제공 방법
>> 3. HTTP API 제공 방법

### SSR (BE)
- 서버 사이드 렌더링
- HTML 최종 결과를 서버에서 만들어서 웹 브라우저에 전달
- 주로 정적인 화면에 사용

### CSR (FE)
- 클라이언트 사이드 렌더링
- HTML 결과를 자바스크립트를 사용해 웹 브라우저에서 동적으로 생성해서 적용
- 부분부분 변경 가능
- 주로 동적인 화면에 사용
